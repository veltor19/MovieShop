@model ApplicationCore.Models.PaginatedResultSet<ApplicationCore.Models.MovieCardModel>

<div class="rounded">
    <div class="container-fluid">
        <div class="row">
            @foreach (var movie in Model.Data) {
                <partial name="_MovieCard" model="movie" />
            }
        </div>

        <!-- Pagination Controls -->
        @if (Model.TotalPages > 1) {
            <div class="row mt-4">
                <div class="col-12">
                    <nav aria-label="Movie pagination">
                        <ul class="pagination justify-content-center">
                            <!-- Previous Button -->
                            <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                                <a class="page-link"
                                   asp-action="MoviesByGenre"
                                   asp-route-genreId="@Model.GenreId"
                                   asp-route-pageNumber="@(Model.CurrentPage - 1)"
                                   asp-route-pageSize="@Model.PageSize">
                                    Previous
                                </a>
                            </li>

                            <!-- Show limited page numbers for better UX -->
                            @{
                                // Show max 7 page buttons
                                int maxButtons = 7;
                                int startPage = 1;
                                int endPage = Model.TotalPages;

                                if (Model.TotalPages > maxButtons) {
                                    int offset = maxButtons / 2;
                                    startPage = Math.Max(1, Model.CurrentPage - offset);
                                    endPage = Math.Min(Model.TotalPages, startPage + maxButtons - 1);

                                    // Adjust if we're near the end
                                    if (endPage == Model.TotalPages) {
                                        startPage = Math.Max(1, endPage - maxButtons + 1);
                                    }
                                }
                            }

                            <!-- Ellipsis before if needed -->
                            @if (startPage > 1) {
                                <li class="page-item">
                                    <a class="page-link"
                                       asp-action="MoviesByGenre"
                                       asp-route-genreId="@Model.GenreId"
                                       asp-route-pageNumber="1"
                                       asp-route-pageSize="@Model.PageSize">
                                        1
                                    </a>
                                </li>
                                @if (startPage > 2) {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                            }

                            <!-- Page Numbers -->
                            @for (int i = startPage; i <= endPage; i++) {
                                <li class="page-item @(Model.CurrentPage == i ? "active" : "")">
                                    <a class="page-link"
                                       asp-action="MoviesByGenre"
                                       asp-route-genreId="@Model.GenreId"
                                       asp-route-pageNumber="@i"
                                       asp-route-pageSize="@Model.PageSize">
                                        @i
                                    </a>
                                </li>
                            }

                            <!-- Ellipsis after if needed -->
                            @if (endPage < Model.TotalPages) {
                                @if (endPage < Model.TotalPages - 1) {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                                <li class="page-item">
                                    <a class="page-link"
                                       asp-action="MoviesByGenre"
                                       asp-route-genreId="@Model.GenreId"
                                       asp-route-pageNumber="@Model.TotalPages"
                                       asp-route-pageSize="@Model.PageSize">
                                        @Model.TotalPages
                                    </a>
                                </li>
                            }

                            <!-- Next Button -->
                            <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                                <a class="page-link"
                                   asp-action="MoviesByGenre"
                                   asp-route-genreId="@Model.GenreId"
                                   asp-route-pageNumber="@(Model.CurrentPage + 1)"
                                   asp-route-pageSize="@Model.PageSize">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        }
    </div>
</div>